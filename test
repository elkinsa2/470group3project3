# CIT 470-0001 Project 2
# Darci Guriel
# Group 3: Austin Elkins, Alyssa Herrman, Lisa Stock
# Client kickstart - %post configured for nfs, ldap installation
# pw - Pointer470

#version=DEVEL
# System authorization information
auth --enableshadow --passalgo=sha512
# Use CDROM installation media
cdrom
text
# Run the Setup Agent on first boot
firstboot --enable
ignoredisk --only-use=sda
# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

# Network information
network  --bootproto=dhcp --device=ens33 --ipv6=auto --activate

# Root password
rootpw --iscrypted $6$AF/LjlbwLlBEybh0$nShZo8oqCbS.cCQtyL5oZLngcU2Fr4GtCY2.sBij5Q0L15bWF49iSm5wpesUN839yHyfqxj5b4uMdBvmSr1qV0

# System services
services --enabled="chronyd"
skipx
# System timezone
timezone America/New_York --isUtc
# System bootloader configuration
bootloader --append=" crashkernel=auto" --location=mbr --boot-drive=sda
# Partition clearing information
clearpart --all --initlabel

# Disk partitioning information
part swap --fstype="swap" --ondisk=sda --size=953
part /var --fstype="xfs" --ondisk=sda --size=953
#part /home --fstype="xfs" --ondisk=sda --size=13351
part / --fstype="xfs" --ondisk=sda --size=3814

%packages
@^minimal
@core
chrony
kexec-tools
wget
bzip2
openldap-clients
nss-pam-ldapd
nfs-utils

%end

%post --log=/root/ks-post.log
/usr/bin/yum update -y
/sbin/authconfig --enableldap --enableldapauth --ldapserver=10.2.7.72 --ldapbasedn="dc=cit470,dc=nku,dc=edu" --enablemkhomedir --update
/bin/systemctl restart nslcd

# --- NFS ---

# enable services
/usr/bin/echo "nfs services enable"
systemctl enable rpcbind
systemctl enable nfs-server
systemctl enable nfs-lock
systemctl enable nfs-idmap

# edit /etc/fstab 
/usr/bin/echo "nfs - modify /etc/fstab"
/usr/bin/echo '10.2.7.72:/home    /home    nfs    defaults  0 0' >> /etc/fstab  

# mount /home
/usr/bin/echo "nfs - mount share"
/usr/bin/mount -t nfs 10.2.7.72:/home /home


%end
%addon com_redhat_kdump --enable --reserve-mb='auto'

%end

%anaconda
pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty
pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok
pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty
%end

reboot
